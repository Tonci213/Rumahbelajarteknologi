<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>CodeQuest: Petualangan Computational Thinking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.1);
      --accent-2: #a855f7;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --radius-lg: 18px;
      --radius-xl: 24px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.7);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #1d283a, #020617);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(145deg, #020617 0%, #020617 30%, #020617 100%);
      border-radius: 24px;
      padding: 24px 24px 32px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 16px;
      align-items: center;
      margin-bottom: 20px;
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.9rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .title-pill {
      font-size: 0.8rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .subtitle {
      margin-top: 6px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .status-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
    }

    .energy-bar-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 180px;
    }

    .energy-label {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .energy-bar {
      flex: 1;
      height: 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.3);
      overflow: hidden;
      position: relative;
    }

    .energy-fill {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #22c55e, #eab308, #ef4444);
      transition: width 0.25s ease-out;
    }

    .energy-value {
      font-size: 0.85rem;
      min-width: 34px;
      text-align: right;
      color: var(--text);
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      border: 1px solid rgba(148, 163, 184, 0.4);
      transition: all 0.18s ease-out;
    }

    .btn:hover {
      background: rgba(22, 163, 255, 0.12);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn-primary {
      background: radial-gradient(circle at top left, var(--accent), var(--accent-2));
      border: none;
      color: #0b1120;
      font-weight: 600;
    }

    .btn-primary:hover {
      filter: brightness(1.1);
      transform: translateY(-1px) translateX(0.5px);
    }

    .btn-ghost {
      background: transparent;
    }

    .btn-small {
      padding: 4px 10px;
      font-size: 0.78rem;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 2fr);
      gap: 16px;
    }

    @media (max-width: 880px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.07), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(168, 85, 247, 0.07), transparent 45%),
                  var(--card);
      border-radius: var(--radius-xl);
      padding: 16px 16px 18px;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .panel h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-subtitle {
      margin: 0 0 12px;
      font-size: 0.82rem;
      color: var(--muted);
    }

    .avatar-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }

    .avatar-card {
      padding: 10px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.9);
      cursor: pointer;
      transition: all 0.16s ease-out;
      position: relative;
      overflow: hidden;
    }

    .avatar-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(250, 250, 250, 0.06), transparent 55%);
      opacity: 0;
      transition: opacity 0.2s ease-out;
    }

    .avatar-card:hover::before {
      opacity: 1;
    }

    .avatar-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.2), rgba(15, 23, 42, 0.96));
    }

    .avatar-name {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 0.95rem;
    }

    .avatar-role {
      font-size: 0.78rem;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .avatar-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.72rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .section-footer {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
    }

    .zones {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }

    .zone-card {
      border-radius: var(--radius-lg);
      padding: 10px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(15, 23, 42, 0.9);
      cursor: pointer;
      transition: all 0.16s ease-out;
      position: relative;
      overflow: hidden;
    }

    .zone-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%);
      opacity: 0;
      transition: opacity 0.18s ease-out;
    }

    .zone-card:hover::before {
      opacity: 1;
    }

    .zone-name {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }

    .zone-tagline {
      font-size: 0.78rem;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .zone-tag {
      font-size: 0.7rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .challenge-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .challenge-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .challenge-body {
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .challenge-block {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 12px;
      margin-bottom: 10px;
    }

    .challenge-block h4 {
      margin: 0 0 6px;
      font-size: 0.9rem;
    }

    .options-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
    }

    .options-list li {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    label {
      font-size: 0.85rem;
      color: var(--text);
      cursor: pointer;
    }

    input[type="checkbox"],
    input[type="radio"] {
      accent-color: var(--accent);
      cursor: pointer;
    }

    select, textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: #020617;
      color: var(--text);
      padding: 6px 8px;
      font-size: 0.85rem;
      outline: none;
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .challenge-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .feedback {
      font-size: 0.82rem;
      margin-top: 6px;
    }

    .feedback.success {
      color: var(--success);
    }

    .feedback.error {
      color: var(--danger);
    }

    .feedback.hint {
      color: var(--accent);
    }

    .hint-text {
      font-size: 0.8rem;
      color: var(--accent);
    }

    .tag-domain {
      font-size: 0.78rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
    }

    .pill-small {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .report-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 12px;
      z-index: 20;
    }

    .report-modal {
      width: 100%;
      max-width: 650px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), rgba(15, 23, 42, 0.98));
      border-radius: 22px;
      padding: 18px 18px 16px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: var(--shadow-soft);
    }

    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .report-title {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .report-subtitle {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .report-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
      margin-top: 10px;
    }

    .report-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 0.8rem;
    }

    .report-card h4 {
      margin: 0 0 4px;
      font-size: 0.9rem;
    }

    .report-level {
      font-size: 0.78rem;
      margin-bottom: 4px;
    }

    .report-level span {
      font-weight: 600;
    }

    .report-actions {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      flex-wrap: wrap;
    }

    .divider {
      height: 1px;
      background: rgba(148, 163, 184, 0.3);
      margin: 16px 0 12px;
    }

    .empty-state {
      font-size: 0.82rem;
      color: var(--muted);
      padding: 10px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px dashed rgba(148, 163, 184, 0.5);
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title-block">
        <div class="title-pill">
          <span>üß†</span><span>Computational Thinking Adventure</span>
        </div>
        <h1>CodeQuest</h1>
        <p class="subtitle">Game individu bergaya Roblox-lite untuk melatih decomposition, pattern, algoritma, dan debugging.</p>
      </div>
      <div class="status-bar">
        <div class="badge">
          <span>üéÆ</span>
          <span id="status-avatar">Belum pilih avatar</span>
        </div>
        <div class="energy-bar-wrapper">
          <span class="energy-label">Energi</span>
          <div class="energy-bar">
            <div class="energy-fill" id="energyFill"></div>
          </div>
          <span class="energy-value" id="energyValue">20</span>
        </div>
        <button class="btn btn-ghost btn-small" id="openReportBtn">üìä Lihat Report</button>
      </div>
    </header>

    <div class="layout">
      <!-- Left: Avatar + Zones -->
      <section class="panel">
        <h2>1. Pilih Avatar</h2>
        <p class="panel-subtitle">Setiap avatar punya gaya berbeda, tapi semua punya kesempatan belajar yang sama.</p>
        <div class="avatar-grid" id="avatarGrid">
          <div class="avatar-card" data-avatar="Explorer">
            <div class="avatar-name">üß≠ Explorer</div>
            <div class="avatar-role">Suka menjelajah dan mencoba tantangan baru.</div>
            <div class="avatar-tag">Fokus: Keberanian mencoba ulang</div>
          </div>
          <div class="avatar-card" data-avatar="Scientist">
            <div class="avatar-name">üß™ Scientist</div>
            <div class="avatar-role">Mengamati pola dan mencatat hasil percobaan.</div>
            <div class="avatar-tag">Fokus: Mengamati pola</div>
          </div>
          <div class="avatar-card" data-avatar="Builder">
            <div class="avatar-name">üèóÔ∏è Builder</div>
            <div class="avatar-role">Menyusun langkah-langkah seperti membangun bangunan.</div>
            <div class="avatar-tag">Fokus: Menyusun langkah</div>
          </div>
          <div class="avatar-card" data-avatar="Coder">
            <div class="avatar-name">üíª Coder</div>
            <div class="avatar-role">Menulis algoritma dan memperbaiki bug.</div>
            <div class="avatar-tag">Fokus: Debugging</div>
          </div>
        </div>
        <div class="divider"></div>
        <h2>2. Pilih Zona</h2>
        <p class="panel-subtitle">Masuk ke salah satu zona di Pulau Logika dan selesaikan tantangannya.</p>
        <div class="zones" id="zones">
          <div class="zone-card" data-challenge="decomposition">
            <div class="zone-name">üè° Kampung Puzzle</div>
            <div class="zone-tagline">Pecah masalah besar jadi langkah-langkah kecil.</div>
            <div class="zone-tag">Decomposition</div>
          </div>
          <div class="zone-card" data-challenge="pattern">
            <div class="zone-name">üå≤ Hutan Pola</div>
            <div class="zone-tagline">Cari dan teruskan pola warna dan gerak.</div>
            <div class="zone-tag">Pattern Recognition</div>
          </div>
          <div class="zone-card" data-challenge="algorithm">
            <div class="zone-name">‚õ∞Ô∏è Lembah Algoritma</div>
            <div class="zone-tagline">Susun algoritma agar avatar sampai tujuan.</div>
            <div class="zone-tag">Algorithmic Thinking</div>
          </div>
          <div class="zone-card" data-challenge="debugging">
            <div class="zone-name">üî¨ Laboratorium Debug</div>
            <div class="zone-tagline">Cari dan perbaiki langkah yang salah.</div>
            <div class="zone-tag">Debugging</div>
          </div>
        </div>
        <p class="panel-subtitle" style="margin-top:10px;font-size:0.78rem;">
          Catatan: Setiap tantangan yang berhasil memberi +5 energi. Jika dalam 1 tantangan kamu 3√ó gagal, energi berkurang -3 tapi kamu dapat hint tambahan.
        </p>
      </section>

      <!-- Right: Challenge Area -->
      <section class="panel" id="challengePanel">
        <div class="challenge-header">
          <div>
            <div class="challenge-title" id="challengeTitle">Belum ada tantangan aktif</div>
            <div class="chip" id="challengeDomainChip">Pilih zona untuk mulai bermain.</div>
          </div>
          <div>
            <span class="pill-small" id="attemptInfo">Percobaan: 0 / 3</span>
          </div>
        </div>
        <p class="challenge-body" id="challengeBody">
          Pilih zona di sebelah kiri untuk memulai tantangan Computational Thinking. Kamu akan mendapatkan feedback setiap kali mencoba.
        </p>
        <div id="challengeContent">
          <div class="empty-state">
            üí° Tips: Mulailah dari <b>Kampung Puzzle</b> untuk belajar mengurai masalah, atau <b>Hutan Pola</b> untuk mencari pola berulang.
          </div>
        </div>
        <div class="challenge-footer">
          <span class="feedback" id="feedbackMsg"></span>
          <div style="display:flex;gap:6px;flex-wrap:wrap;">
            <button class="btn btn-small btn-ghost" id="resetChallengeBtn">‚Ü∫ Reset Tantangan</button>
            <button class="btn btn-small btn-primary" id="submitChallengeBtn">‚úÖ Cek Jawaban</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Report Modal -->
  <div class="report-overlay" id="reportOverlay">
    <div class="report-modal">
      <div class="report-header">
        <div>
          <div class="report-title">Report Computational Thinking</div>
          <div class="report-subtitle" id="reportSubtitle">
            Ringkasan progres berdasarkan tantangan yang sudah kamu selesaikan.
          </div>
        </div>
        <button class="btn btn-ghost btn-small" id="closeReportBtn">‚úï Tutup</button>
      </div>
      <div class="divider" style="margin-top:4px;"></div>
      <div class="report-grid" id="reportGrid">
        <!-- Filled by JS -->
      </div>
      <div class="divider"></div>
      <div style="font-size:0.8rem;color:var(--muted);">
        Di akhir sesi, guru atau orang tua dapat menggunakan report ini untuk melihat: apa yang sudah kuat, apa yang perlu dipertahankan, dan apa yang perlu dilatih lagi.
      </div>
      <div class="report-actions">
        <button class="btn btn-small btn-ghost" id="clearStatsBtn">üßπ Reset Progress</button>
      </div>
    </div>
  </div>

  <script>
    // ================== STATE GAME ==================
    const MAX_ATTEMPTS = 3;
    const INITIAL_ENERGY = 20;

    const gameState = {
      avatar: null,
      energy: INITIAL_ENERGY,
      currentChallenge: null,
      attemptsCurrent: 0,
      stats: {
        decomposition: { label: "Decomposition", success: 0, attempts: 0 },
        pattern: { label: "Pattern Recognition", success: 0, attempts: 0 },
        algorithm: { label: "Algorithmic Thinking", success: 0, attempts: 0 },
        debugging: { label: "Debugging", success: 0, attempts: 0 }
      }
    };

    // ================== DOM ELEMENTS ==================
    const energyFill = document.getElementById("energyFill");
    const energyValue = document.getElementById("energyValue");
    const statusAvatar = document.getElementById("status-avatar");
    const feedbackMsg = document.getElementById("feedbackMsg");
    const attemptInfo = document.getElementById("attemptInfo");
    const challengeTitle = document.getElementById("challengeTitle");
    const challengeBody = document.getElementById("challengeBody");
    const challengeContent = document.getElementById("challengeContent");
    const challengeDomainChip = document.getElementById("challengeDomainChip");

    const avatarGrid = document.getElementById("avatarGrid");
    const zones = document.getElementById("zones");
    const resetChallengeBtn = document.getElementById("resetChallengeBtn");
    const submitChallengeBtn = document.getElementById("submitChallengeBtn");

    const reportOverlay = document.getElementById("reportOverlay");
    const openReportBtn = document.getElementById("openReportBtn");
    const closeReportBtn = document.getElementById("closeReportBtn");
    const reportGrid = document.getElementById("reportGrid");
    const reportSubtitle = document.getElementById("reportSubtitle");
    const clearStatsBtn = document.getElementById("clearStatsBtn");

    // ================== UTILITAS UI ==================
    function updateEnergy(delta) {
      gameState.energy = Math.max(0, gameState.energy + delta);
      energyValue.textContent = gameState.energy;
      // Asumsikan rentang 0-40 utk bar visual
      const widthPercent = Math.min(100, (gameState.energy / 40) * 100);
      energyFill.style.width = widthPercent + "%";
    }

    function setAvatar(name) {
      gameState.avatar = name;
      statusAvatar.textContent = "Avatar: " + name;
    }

    function setFeedback(text, type) {
      feedbackMsg.textContent = text || "";
      feedbackMsg.className = "feedback";
      if (type === "success") feedbackMsg.classList.add("success");
      if (type === "error") feedbackMsg.classList.add("error");
      if (type === "hint") feedbackMsg.classList.add("hint");
    }

    function updateAttemptInfo() {
      attemptInfo.textContent = "Percobaan: " + gameState.attemptsCurrent + " / " + MAX_ATTEMPTS;
    }

    function resetAttempts() {
      gameState.attemptsCurrent = 0;
      updateAttemptInfo();
    }

    function setCurrentChallenge(challengeId) {
      gameState.currentChallenge = challengeId;
      resetAttempts();
      setFeedback("", "");
    }

    // ================== RENDER CHALLENGES ==================

    function renderDecompositionChallenge() {
      challengeTitle.textContent = "Kampung Puzzle ‚Äì Persiapan Pesta Sekolah";
      challengeBody.textContent = "Kamu diminta membantu warga menyiapkan pesta sekolah. Pilih langkah-langkah yang termasuk bagian dari persiapan pesta. (Boleh lebih dari satu)";
      challengeDomainChip.textContent = "Zona: Decomposition";

      challengeContent.innerHTML = `
        <div class="challenge-block">
          <h4>Masalah Besar:</h4>
          <p>Mengadakan pesta sekolah akhir semester.</p>
        </div>
        <div class="challenge-block">
          <h4>Pilih langkah yang tepat:</h4>
          <ul class="options-list">
            <li>
              <input type="checkbox" id="dec1" value="1">
              <label for="dec1">Membuat daftar makanan dan minuman yang akan disajikan.</label>
            </li>
            <li>
              <input type="checkbox" id="dec2" value="2">
              <label for="dec2">Menyusun jadwal latihan lomba dan penampilan siswa.</label>
            </li>
            <li>
              <input type="checkbox" id="dec3" value="3">
              <label for="dec3">Menghafal semua pelajaran Matematika dari kelas 1 sampai 6.</label>
            </li>
            <li>
              <input type="checkbox" id="dec4" value="4">
              <label for="dec4">Menata kursi dan dekorasi aula sekolah.</label>
            </li>
            <li>
              <input type="checkbox" id="dec5" value="5">
              <label for="dec5">Membeli hadiah kecil untuk pemenang lomba.</label>
            </li>
          </ul>
          <p class="hint-text">Hint: Pilih langkah yang langsung membantu persiapan pesta, bukan tujuan akademik lain.</p>
        </div>
      `;
    }

    function checkDecompositionAnswer() {
      const correct = ["1", "2", "4", "5"]; // yang benar
      const wrong = ["3"];
      const selected = Array.from(challengeContent.querySelectorAll("input[type='checkbox']:checked"))
        .map(el => el.value);

      if (selected.length === 0) {
        return { correct: false, message: "Pilih setidaknya satu langkah yang menurutmu bagian dari persiapan pesta." };
      }

      // Cek apakah ada pilihan salah
      for (let v of selected) {
        if (wrong.includes(v)) {
          return { correct: false, message: "Masih ada langkah yang tidak termasuk persiapan pesta. Coba pikir, apakah ini benar-benar membantu pesta?" };
        }
      }
      // Cek apakah semua langkah benar dipilih
      for (let v of correct) {
        if (!selected.includes(v)) {
          return { correct: false, message: "Ada langkah penting yang belum kamu pilih. Coba cek lagi daftar tugasnya." };
        }
      }

      return { correct: true, message: "Keren! Kamu berhasil mengurai masalah besar menjadi langkah-langkah kecil yang tepat." };
    }

    function renderPatternChallenge() {
      challengeTitle.textContent = "Hutan Pola ‚Äì Batu Berwarna";
      challengeBody.textContent = "Kamu berjalan di jalur batu berwarna di Hutan Pola. Kamu harus menebak warna batu berikutnya agar tidak jatuh.";
      challengeDomainChip.textContent = "Zona: Pattern Recognition";

      challengeContent.innerHTML = `
        <div class="challenge-block">
          <h4>Pola Batu:</h4>
          <p>Merah, Biru, Biru, Merah, Biru, Biru, Merah, Biru, Biru, <b>?</b></p>
        </div>
        <div class="challenge-block">
          <h4>Pilih warna batu berikutnya:</h4>
          <ul class="options-list">
            <li>
              <input type="radio" name="pattern" id="pat1" value="Merah">
              <label for="pat1">Merah</label>
            </li>
            <li>
              <input type="radio" name="pattern" id="pat2" value="Biru">
              <label for="pat2">Biru</label>
            </li>
            <li>
              <input type="radio" name="pattern" id="pat3" value="Hijau">
              <label for="pat3">Hijau</label>
            </li>
          </ul>
          <p class="hint-text">Hint: Perhatikan urutan "Merah, Biru, Biru" yang berulang.</p>
        </div>
      `;
    }

    function checkPatternAnswer() {
      const selected = challengeContent.querySelector("input[name='pattern']:checked");
      if (!selected) {
        return { correct: false, message: "Pilih satu warna batu yang menurutmu paling tepat." };
      }
      if (selected.value === "Merah") {
        return { correct: false, message: "Coba perhatikan lagi: setelah 'Merah' selalu datang dua warna yang sama sebelumnya." };
      }
      if (selected.value === "Hijau") {
        return { correct: false, message: "Di pola yang diberikan tidak ada warna hijau. Coba pikir lagi dari awal." };
      }
      return { correct: true, message: "Hebat! Kamu menemukan pola 'Merah, Biru, Biru' yang berulang terus." };
    }

    function renderAlgorithmChallenge() {
      challengeTitle.textContent = "Lembah Algoritma ‚Äì Kunci Gerbang";
      challengeBody.textContent = "Kamu harus menyusun algoritma agar avatar mencapai gerbang dan mengambil kunci.";
      challengeDomainChip.textContent = "Zona: Algorithmic Thinking";

      challengeContent.innerHTML = `
        <div class="challenge-block">
          <h4>Situasi:</h4>
          <p>Avatar berdiri di titik awal. Di depan ada jalan lurus 3 langkah, lalu belok kanan ke tempat kunci, lalu maju 1 langkah untuk sampai ke kunci.</p>
        </div>
        <div class="challenge-block">
          <h4>Susun urutan langkah yang benar (1‚Äì4):</h4>
          <p style="margin-bottom:6px;">Isi nomor urut di setiap langkah, tanpa mengulang angka.</p>
          <ul class="options-list">
            <li>
              <label for="alg1">_____ Maju 3 langkah ke depan.</label>
              <select id="alg1">
                <option value="">‚Äì</option>
                <option>1</option><option>2</option><option>3</option><option>4</option>
              </select>
            </li>
            <li>
              <label for="alg2">_____ Belok kanan.</label>
              <select id="alg2">
                <option value="">‚Äì</option>
                <option>1</option><option>2</option><option>3</option><option>4</option>
              </select>
            </li>
            <li>
              <label for="alg3">_____ Maju 1 langkah untuk mengambil kunci.</label>
              <select id="alg3">
                <option value="">‚Äì</option>
                <option>1</option><option>2</option><option>3</option><option>4</option>
              </select>
            </li>
            <li>
              <label for="alg4">_____ Berteriak 'Aku sudah sampai!' (opsional, tidak wajib dilakukan sebelum kunci diambil).</label>
              <select id="alg4">
                <option value="">‚Äì</option>
                <option>1</option><option>2</option><option>3</option><option>4</option>
              </select>
            </li>
          </ul>
          <p class="hint-text">Hint: Pastikan kunci diambil dulu sebelum bersorak.</p>
        </div>
      `;
    }

    function checkAlgorithmAnswer() {
      const s1 = document.getElementById("alg1").value;
      const s2 = document.getElementById("alg2").value;
      const s3 = document.getElementById("alg3").value;
      const s4 = document.getElementById("alg4").value;

      if (!s1 || !s2 || !s3 || !s4) {
        return { correct: false, message: "Isi semua nomor urut 1‚Äì4 terlebih dahulu." };
      }

      const all = [s1, s2, s3, s4];
      const unique = new Set(all);
      if (unique.size !== 4) {
        return { correct: false, message: "Setiap nomor urut hanya boleh dipakai sekali." };
      }

      // Jawaban benar: maju 3 langkah (1), belok kanan (2), maju 1 langkah (3), bersorak (4)
      if (s1 === "1" && s2 === "2" && s3 === "3" && s4 === "4") {
        return { correct: true, message: "Mantap! Algoritmamu terurut dengan logis dan efisien." };
      }

      if (s4 === "1" || s4 === "2" || s4 === "3") {
        return { correct: false, message: "Kamu bersorak terlalu cepat. Coba pastikan kunci sudah diambil dulu." };
      }

      return { correct: false, message: "Urutannya belum tepat. Pikirkan: jalan dulu, belok, ambil kunci, baru bersorak." };
    }

    function renderDebuggingChallenge() {
      challengeTitle.textContent = "Laboratorium Debug ‚Äì Mie Instan Bermasalah";
      challengeBody.textContent = "Kamu menemukan urutan langkah memasak mie instan yang salah. Tugasmu adalah menemukan langkah yang tidak tepat.";
      challengeDomainChip.textContent = "Zona: Debugging";

      challengeContent.innerHTML = `
        <div class="challenge-block">
          <h4>Program Memasak Mie Instan (Versi Salah):</h4>
          <ol style="padding-left:18px;font-size:0.85rem;">
            <li>Tuang bumbu ke mangkuk.</li>
            <li>Masukkan mie ke panci.</li>
            <li>Tuang mie yang masih kering ke mangkuk.</li>
            <li>Isi panci dengan air dan rebus sampai mendidih.</li>
            <li>Masukkan mie yang sudah matang ke mangkuk berisi bumbu.</li>
          </ol>
        </div>
        <div class="challenge-block">
          <h4>Pertanyaan:</h4>
          <p>Langkah nomor berapa yang membuat program ini menjadi salah?</p>
          <select id="dbgStepSelect">
            <option value="">Pilih nomor langkah yang salah</option>
            <option value="1">Langkah 1</option>
            <option value="2">Langkah 2</option>
            <option value="3">Langkah 3</option>
            <option value="4">Langkah 4</option>
            <option value="5">Langkah 5</option>
          </select>
          <p class="hint-text">Hint: Apakah ada mie kering yang langsung dituang ke mangkuk?</p>
        </div>
      `;
    }

    function checkDebuggingAnswer() {
      const v = document.getElementById("dbgStepSelect").value;
      if (!v) {
        return { correct: false, message: "Pilih satu langkah yang menurutmu salah." };
      }
      if (v === "3") {
        return { correct: true, message: "Bagus! Langkah 3 membuat mie kering langsung masuk mangkuk. Itu bug yang kamu temukan." };
      }
      return { correct: false, message: "Belum tepat. Coba pikir, di langkah mana urutan memasak menjadi tidak masuk akal." };
    }

    // ================== DISPATCHER CHALLENGES ==================
    function renderChallenge(challengeId) {
      setCurrentChallenge(challengeId);

      switch (challengeId) {
        case "decomposition":
          renderDecompositionChallenge();
          break;
        case "pattern":
          renderPatternChallenge();
          break;
        case "algorithm":
          renderAlgorithmChallenge();
          break;
        case "debugging":
          renderDebuggingChallenge();
          break;
        default:
          challengeContent.innerHTML = "<div class='empty-state'>Pilih zona di panel sebelah kiri untuk memulai tantangan.</div>";
      }
    }

    function checkCurrentChallenge() {
      if (!gameState.currentChallenge) {
        return { correct: null, message: "Belum ada tantangan yang dipilih. Silakan pilih zona terlebih dahulu." };
      }
      let result;
      switch (gameState.currentChallenge) {
        case "decomposition":
          result = checkDecompositionAnswer();
          result.domain = "decomposition";
          return result;
        case "pattern":
          result = checkPatternAnswer();
          result.domain = "pattern";
          return result;
        case "algorithm":
          result = checkAlgorithmAnswer();
          result.domain = "algorithm";
          return result;
        case "debugging":
          result = checkDebuggingAnswer();
          result.domain = "debugging";
          return result;
        default:
          return { correct: null, message: "Tantangan tidak dikenal." };
      }
    }

    // ================== REPORT CT ==================
    function levelFromStats(stat) {
      if (stat.success === 0) return { level: "Beginner", desc: "Kamu baru mulai mencoba tantangan di area ini. Tidak apa-apa, setiap ahli juga pernah jadi pemula." };
      if (stat.success === 1) return { level: "Developing", desc: "Kamu mulai memahami konsep ini. Teruskan latihan dengan membaca soal pelan-pelan." };
      if (stat.success === 2) return { level: "Proficient", desc: "Kamu cukup kuat di area ini. Pertahankan dan bantu temanmu jika mereka butuh." };
      if (stat.success >= 3) return { level: "Advanced", desc: "Kamu sangat kuat di area ini. Coba jelaskan dengan katamu sendiri ke orang lain." };
    }

    function generateSuggestions(statKey, stat) {
      switch (statKey) {
        case "decomposition":
          if (stat.success === 0) return "Latih lagi dengan mencoba mengurai kegiatan sehari-hari menjadi beberapa langkah kecil.";
          if (stat.success === 1) return "Coba buat daftar langkah yang lebih lengkap ketika menghadapi masalah besar.";
          return "Pertahankan caramu memecah masalah. Kamu sudah seperti project planner!";
        case "pattern":
          if (stat.success === 0) return "Biasakan memperhatikan pengulangan dalam warna, angka, atau gerakan.";
          if (stat.success === 1) return "Coba tebak pola berikutnya sebelum melihat jawaban.";
          return "Kamu jago melihat pola. Pertahankan dan gunakan untuk memprediksi hal berikutnya.";
        case "algorithm":
          if (stat.success === 0) return "Latih urutan langkah dengan menuliskan langkah harianmu secara runtut.";
          if (stat.success === 1) return "Pastikan tidak ada langkah yang tertukar, dari awal sampai akhir.";
          return "Algoritmamu rapi dan jelas. Pertahankan kebiasaan berpikir terurut.";
        case "debugging":
          if (stat.success === 0) return "Coba biasakan mengecek langkah satu per satu ketika ada yang salah.";
          if (stat.success === 1) return "Saat ada error, jangan hapus semua. Cek pelan-pelan langkah mana yang tidak masuk akal.";
          return "Kamu seperti detektif bug. Pertahankan strategimu dalam menemukan kesalahan.";
      }
    }

    function updateReport() {
      const avatarInfo = gameState.avatar ? "Avatar: " + gameState.avatar + " ‚Ä¢ Energi saat ini: " + gameState.energy : "Belum memilih avatar. Energi saat ini: " + gameState.energy;
      reportSubtitle.textContent = avatarInfo;

      reportGrid.innerHTML = "";

      Object.entries(gameState.stats).forEach(([key, stat]) => {
        const levelInfo = levelFromStats(stat);
        const suggestion = generateSuggestions(key, stat);
        const card = document.createElement("div");
        card.className = "report-card";
        card.innerHTML = `
          <h4>${stat.label}</h4>
          <div class="report-level">Level: <span>${levelInfo.level}</span></div>
          <div>Berhasil: <b>${stat.success}</b> tantangan</div>
          <div>Coba: ${stat.attempts} kali</div>
          <p style="margin-top:4px;">${levelInfo.desc}</p>
          <p style="margin-top:4px;color:var(--accent);font-size:0.78rem;">Saran: ${suggestion}</p>
        `;
        reportGrid.appendChild(card);
      });
    }

    // ================== EVENT HANDLERS ==================

    // Avatar selection
    avatarGrid.addEventListener("click", (e) => {
      const card = e.target.closest(".avatar-card");
      if (!card) return;
      const avatar = card.dataset.avatar;
      setAvatar(avatar);

      // Visual select
      Array.from(avatarGrid.querySelectorAll(".avatar-card")).forEach(c => c.classList.remove("selected"));
      card.classList.add("selected");
    });

    // Zone selection
    zones.addEventListener("click", (e) => {
      const card = e.target.closest(".zone-card");
      if (!card) return;
      const challengeId = card.dataset.challenge;
      renderChallenge(challengeId);
    });

    // Reset challenge (UI only)
    resetChallengeBtn.addEventListener("click", () => {
      if (!gameState.currentChallenge) {
        setFeedback("Belum ada tantangan yang dipilih.", "hint");
        return;
      }
      renderChallenge(gameState.currentChallenge);
      setFeedback("Tantangan di-reset. Coba susun ulang jawabanmu.", "hint");
    });

    // Submit challenge
    submitChallengeBtn.addEventListener("click", () => {
      const result = checkCurrentChallenge();
      if (result.correct === null) {
        setFeedback(result.message, "hint");
        return;
      }

      if (!result.domain) {
        result.domain = gameState.currentChallenge || "decomposition";
      }

      const stat = gameState.stats[result.domain];
      stat.attempts += 1;

      if (result.correct) {
        // Jawaban benar
        stat.success += 1;
        updateEnergy(+5);
        setFeedback(result.message + " (+5 energi)", "success");
        resetAttempts();
      } else {
        // Jawaban salah
        gameState.attemptsCurrent += 1;
        if (gameState.attemptsCurrent >= MAX_ATTEMPTS) {
          updateEnergy(-3);
          setFeedback(result.message + " Kamu sudah mencoba 3√ó. Energi -3. Kamu boleh mencoba lagi dengan lebih hati-hati.", "error");
          resetAttempts();
        } else {
          setFeedback(result.message + " (Percobaan ke-" + gameState.attemptsCurrent + ")", "error");
          updateAttemptInfo();
        }
      }
    });

    // Report modal
    openReportBtn.addEventListener("click", () => {
      updateReport();
      reportOverlay.style.display = "flex";
    });

    closeReportBtn.addEventListener("click", () => {
      reportOverlay.style.display = "none";
    });

    reportOverlay.addEventListener("click", (e) => {
      if (e.target === reportOverlay) {
        reportOverlay.style.display = "none";
      }
    });

    clearStatsBtn.addEventListener("click", () => {
      if (!confirm("Yakin ingin mereset progress (statistik & energi) untuk sesi ini?")) return;
      gameState.energy = INITIAL_ENERGY;
      Object.values(gameState.stats).forEach(stat => {
        stat.success = 0;
        stat.attempts = 0;
      });
      updateEnergy(0);
      updateReport();
      setFeedback("Progress di-reset. Kamu bisa mulai bermain lagi dari awal.", "hint");
    });

    // ================== INIT ==================
    updateEnergy(0);
    resetAttempts();
  </script>
</body>
</html>
